{
  "wrapper": "plaintext",
  "text": "Hi,\n\nI have a weird issue - spark streaming application fails once/twice a day\nwith java.io.OptionalDataException. It happens when deserializing task.\n\nThe problem appeared after migration from spark 1.6 to spark 2.2, cluster\nruns in latest CDH distro, YARN mode.\n\nI have no clue what to blame and where to search for problems, maybe you\nhave some ideas?\n\nOverall application works stable, but once a day fails with this exception\n\nThe trace:\njava.io.OptionalDataException\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1371)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.mutable.HashMap$$anonfun$readObject$1.apply(HashMap.scala:143)\nat\nscala.collection.mutable.HashMap$$anonfun$readObject$1.apply(HashMap.scala:143)\nat scala.collection.mutable.HashTable$class.init(HashTable.scala:106)\nat scala.collection.mutable.HashMap.init(HashMap.scala:40)\nat scala.collection.mutable.HashMap.readObject(HashMap.scala:143)\nat sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.immutable.List$SerializationProxy.readObject(List.scala:479)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.immutable.List$SerializationProxy.readObject(List.scala:479)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.immutable.List$SerializationProxy.readObject(List.scala:479)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.immutable.List$SerializationProxy.readObject(List.scala:479)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\norg.apache.spark.serializer.JavaDeserializationStream.readObject(JavaSerializer.scala:75)\nat\norg.apache.spark.serializer.JavaSerializerInstance.deserialize(JavaSerializer.scala:114)\nat\norg.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:85)\nat\norg.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:53)\nat org.apache.spark.scheduler.Task.run(Task.scala:99)\nat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:322)\nat\njava.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\nat\njava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\nat java.lang.Thread.run(Thread.java:745)\n\n",
  "denotations": [
    {
      "id": 1,
      "start": 0,
      "end": 4,
      "text": "Hi,\n",
      "type": "Body/Intro",
      "meta": null
    },
    {
      "id": 2,
      "start": 0,
      "end": 9839,
      "text": "Hi,\n\nI have a weird issue - spark streaming application fails once/twice a day\nwith java.io.OptionalDataException. It happens when deserializing task.\n\nThe problem appeared after migration from spark 1.6 to spark 2.2, cluster\nruns in latest CDH distro, YARN mode.\n\nI have no clue what to blame and where to search for problems, maybe you\nhave some ideas?\n\nOverall application works stable, but once a day fails with this exception\n\nThe trace:\njava.io.OptionalDataException\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1371)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.mutable.HashMap$$anonfun$readObject$1.apply(HashMap.scala:143)\nat\nscala.collection.mutable.HashMap$$anonfun$readObject$1.apply(HashMap.scala:143)\nat scala.collection.mutable.HashTable$class.init(HashTable.scala:106)\nat scala.collection.mutable.HashMap.init(HashMap.scala:40)\nat scala.collection.mutable.HashMap.readObject(HashMap.scala:143)\nat sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.immutable.List$SerializationProxy.readObject(List.scala:479)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.immutable.List$SerializationProxy.readObject(List.scala:479)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.immutable.List$SerializationProxy.readObject(List.scala:479)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\nscala.collection.immutable.List$SerializationProxy.readObject(List.scala:479)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:497)\nat java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)\nat java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)\nat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)\nat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)\nat java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)\nat\norg.apache.spark.serializer.JavaDeserializationStream.readObject(JavaSerializer.scala:75)\nat\norg.apache.spark.serializer.JavaSerializerInstance.deserialize(JavaSerializer.scala:114)\nat\norg.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:85)\nat\norg.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:53)\nat org.apache.spark.scheduler.Task.run(Task.scala:99)\nat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:322)\nat\njava.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\nat\njava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\nat java.lang.Thread.run(Thread.java:745)\n\n",
      "type": "Body",
      "meta": null
    }
  ],
  "meta": {},
  "id": "test/train_4549"
}